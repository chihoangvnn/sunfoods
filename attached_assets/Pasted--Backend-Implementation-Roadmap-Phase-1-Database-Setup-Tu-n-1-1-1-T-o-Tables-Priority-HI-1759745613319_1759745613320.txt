
ğŸš€ Backend Implementation Roadmap
Phase 1: Database Setup (Tuáº§n 1)
1.1 Táº¡o Tables

Priority HIGH:
â–¡ vendor_returns (cho return management)
â–¡ vendor_push_subscriptions (cho notifications)  
â–¡ affiliates (cho affiliate portal)
â–¡ affiliate_orders
â–¡ affiliate_share_logs
Priority MEDIUM:
â–¡ vendor_transactions (financial tracking)
â–¡ vendor_shipments (shipping integration)
â–¡ affiliate_unlocks
â–¡ affiliate_commissions
1.2 Migrations

Sá»­ dá»¥ng Drizzle ORM (Ä‘Ã£ setup sáºµn)
Cháº¡y npm run db:push Ä‘á»ƒ sync schema
Seed initial data cho testing
Phase 2: Core APIs (Tuáº§n 2-3)
2.1 Vendor Portal APIs (Priority: HIGH)

â–¡ GET/POST /api/vendor/returns (list, approve, reject)
â–¡ GET /api/vendor/returns/analytics
â–¡ POST /api/vendor/notifications/subscribe
â–¡ POST /api/vendor/products/bulk-upload (Excel)
â–¡ PATCH /api/vendor/products/bulk-update-*
â–¡ GET /api/vendor/financial/* (balance, transactions)
2.2 Affiliate Portal APIs (Priority: HIGH)

â–¡ GET /api/affiliate/dashboard
â–¡ GET /api/affiliate/products
â–¡ POST /api/affiliate/products/{id}/unlock
â–¡ POST /api/affiliate/orders (quick order)
â–¡ POST /api/affiliate/share/log
â–¡ GET /api/affiliate/share/check-limit
â–¡ GET /api/affiliate/earnings
Spec chi tiáº¿t: Äá»c file customer-mobile-shop/BACKEND_API_SPEC.md

Phase 3: Third-party Integrations (Tuáº§n 3-4)
3.1 Shipping Carriers

â–¡ GHN API integration (recommended first)
  - Create shipment
  - Generate label PDF
  - Tracking webhook
  
â–¡ GHTK API (optional)
â–¡ Viettel Post API (optional)
3.2 Web Push Notifications

â–¡ Setup web-push library (npm i web-push)
â–¡ Use VAPID keys tá»« env (Ä‘Ã£ cÃ³ sáºµn)
â–¡ Implement notification triggers:
  - New order â†’ push to vendor
  - Return request â†’ push to vendor
  - Low stock â†’ daily check
  - Payment reminder â†’ 3 days before due
3.3 Facebook Integration (cho Affiliate)

â–¡ Open Graph meta tags dynamic
â–¡ Share URL tracking (?ref=affiliateId)
â–¡ Cookie persistence cho attribution
Phase 4: Business Logic (Tuáº§n 4)
4.1 Vendor Return Refunds

// Logic tÃ­nh refund theo payment model
switch(vendor.paymentModel) {
  case 'deposit': 
    vendor.depositBalance += refundAmount
    break
  case 'monthly':
    vendor.monthlyDebt -= refundAmount
    break
  case 'upfront':
    return error('Returns not allowed')
  case 'revenue_share':
    refundAmount = orderTotal * vendor.sharePercent
    vendor.balance -= refundAmount
}
4.2 Affiliate Commission Tiers

// Auto tier upgrade
if (totalSales >= 50M) tier = 'platinum', rate = 12%
else if (totalSales >= 20M) tier = 'gold', rate = 10%
else if (totalSales >= 5M) tier = 'silver', rate = 7%
else tier = 'bronze', rate = 5%
// Commission per order
commission = orderTotal * rate
4.3 Share Rate Limiting

// Max 4 shares/day, 2h gap
const sharesPerDay = 4
const minGapHours = 2
Phase 5: Real-time Features (Tuáº§n 5)
5.1 WebSocket/SSE cho Notifications

â–¡ Setup WebSocket server
â–¡ Emit events: new_order, return_request, low_stock
â–¡ Client subscribe via /api/vendor/notifications/stream
5.2 Order Status Updates

â–¡ Webhook tá»« shipping carriers
â–¡ Real-time order tracking
â–¡ Push notification khi delivered
Phase 6: Testing & Security (Tuáº§n 6)
6.1 Testing

â–¡ Unit tests cho business logic
â–¡ Integration tests cho APIs
â–¡ Load testing cho bulk operations
â–¡ E2E tests cho critical flows
6.2 Security

â–¡ Session authentication (Ä‘Ã£ cÃ³)
â–¡ CSRF protection
â–¡ Rate limiting (Express)
â–¡ Input validation (Zod/Joi)
â–¡ SQL injection prevention (Drizzle ORM)
Phase 7: Deployment (Tuáº§n 7)
7.1 Environment Setup

â–¡ Production database (Neon)
â–¡ Redis cho sessions
â–¡ Environment variables:
  - VAPID_PUBLIC_KEY, VAPID_PRIVATE_KEY
  - GHN_API_KEY, GHTK_TOKEN
  - DATABASE_URL
7.2 Deploy to Vercel

â–¡ Serverless functions
â–¡ Edge middleware cho sessions
â–¡ Static assets CDN
ğŸ“‹ Quick Start Checklist
Báº¯t Ä‘áº§u ngay:
âœ… Clone repo, cÃ i dependencies
âœ… Setup Postgres database (Neon)
âœ… Copy .env.example â†’ .env.local
âœ… Cháº¡y npm run db:push Ä‘á»ƒ táº¡o tables
âœ… Äá»c BACKEND_API_SPEC.md Ä‘á»ƒ hiá»ƒu API structure
âœ… Implement 1 module Ä‘Æ¡n giáº£n trÆ°á»›c (vÃ­ dá»¥: Affiliate Dashboard)
âœ… Test vá»›i mock data tá»« frontend
âœ… Káº¿t ná»‘i API tháº­t, remove mock data
ğŸ¯ Priority Matrix
Must Have (Launch blockers):

Vendor Returns API
Affiliate Orders API
Web Push subscriptions
1 shipping carrier (GHN)
Should Have (Post-launch):

Analytics endpoints
Bulk operations optimization
Additional shipping carriers
Advanced reporting
Nice to Have:

Real-time WebSocket
Advanced analytics
Multi-language support
ğŸ“ Support Docs
API Spec: customer-mobile-shop/BACKEND_API_SPEC.md
Database Schema: Trong BACKEND_API_SPEC.md section 6
Business Logic: Section 8 trong spec
Replit Docs: replit.md
Frontend Ä‘Ã£ sáºµn sÃ ng vá»›i mock data. Backend implement theo spec, frontend tá»± Ä‘á»™ng hoáº¡t Ä‘á»™ng! ğŸš€


