================================================================================
         H∆Ø·ªöNG D·∫™N DEPLOY HO√ÄN CH·ªàNH CHO SUNFOODS.VN VPS
================================================================================

üì¶ PACKAGE N√ÄY BAO G·ªíM:
  ‚úì admin/                    - Admin dashboard ƒë√£ build s·∫µn
  ‚úì nginx.conf     - Nginx config v·ªõi SSL, caching, security
  ‚úì ecosystem.config.js   - PM2 config v·ªõi clustering
  ‚úì deploy-to-vps.sh          - Script t·ª± ƒë·ªông deploy
  ‚úì DEPLOY-INSTRUCTIONS.txt   - File n√†y

================================================================================
  B∆Ø·ªöC 1: UPLOAD L√äN VPS
================================================================================

T·ª´ m√°y local, upload file l√™n VPS:

  scp deployment-complete.tar.gz root@your-vps-ip:/tmp/

Ho·∫∑c d√πng WinSCP/FileZilla ƒë·ªÉ upload file l√™n /tmp/

================================================================================
  B∆Ø·ªöC 2: SSH V√ÄO VPS
================================================================================

  ssh root@your-vps-ip

================================================================================
  B∆Ø·ªöC 3: EXTRACT V√Ä CH·∫†Y DEPLOYMENT
================================================================================

Ch·∫°y c√°c l·ªánh sau tr√™n VPS:

  # Extract deployment package
  cd /tmp
  tar -xzf deployment-complete.tar.gz
  cd deployment-complete

  # Make script executable
  chmod +x deploy-to-vps.sh

  # Run deployment script
  bash deploy-to-vps.sh

Script s·∫Ω t·ª± ƒë·ªông:
  ‚úì Backup admin c≈© (n·∫øu c√≥)
  ‚úì Deploy admin files m·ªõi
  ‚úì Clear Nginx proxy cache
  ‚úì Restart PM2 processes (backend + mobile)
  ‚úì Reload Nginx
  ‚úì Verify deployment

================================================================================
  B∆Ø·ªöC 4: VERIFY DEPLOYMENT
================================================================================

1. M·ªû BROWSER V√Ä V√ÄO ADMIN:
   
   URL: https://sunfoods.vn/adminhoang/login

2. HARD REFRESH ƒê·ªÇ CLEAR BROWSER CACHE:
   
   Windows/Linux: Ctrl + Shift + R
   macOS:         Cmd + Shift + R

3. KI·ªÇM TRA CSS ƒê√É LOAD:
   
   ‚Ä¢ M·ªü DevTools (F12)
   ‚Ä¢ Tab Network ‚Üí Filter CSS
   ‚Ä¢ T√¨m file: index-WjAjsFk0.css
   ‚Ä¢ Status ph·∫£i l√†: 200 OK (m√†u xanh)

4. LOGIN V√ÄO ADMIN:
   
   Email:    admin@example.com
   Password: admin123

5. KI·ªÇM TRA MOBILE FRONTEND:
   
   URL: https://sunfoods.vn/

================================================================================
  C·∫§U H√åNH NGINX (N·∫øu ch∆∞a setup)
================================================================================

N·∫øu ƒë√¢y l√† l·∫ßn ƒë·∫ßu deploy ho·∫∑c c·∫ßn update Nginx config:

1. Copy Nginx config:
   
   sudo cp nginx.conf /etc/nginx/sites-available/sunfoods.vn

2. Update SSL certificate paths trong file (n·∫øu c·∫ßn):
   
   sudo nano /etc/nginx/sites-available/sunfoods.vn
   
   # T√¨m v√† update c√°c d√≤ng:
   ssl_certificate /etc/letsencrypt/live/sunfoods.vn/fullchain.pem;
   ssl_certificate_key /etc/letsencrypt/live/sunfoods.vn/privkey.pem;

3. Enable site:
   
   sudo ln -sf /etc/nginx/sites-available/sunfoods.vn /etc/nginx/sites-enabled/

4. Test v√† reload Nginx:
   
   sudo nginx -t
   sudo systemctl reload nginx

================================================================================
  C·∫§U H√åNH PM2 (N·∫øu ch∆∞a setup)
================================================================================

N·∫øu c·∫ßn update PM2 config:

1. Copy PM2 ecosystem config:
   
   sudo cp ecosystem.config.js /var/www/sun/

2. Stop c√°c processes c≈© (n·∫øu c√≥):
   
   pm2 delete all

3. Start v·ªõi config m·ªõi:
   
   cd /var/www/sun
   pm2 start ecosystem.config.js

4. Save PM2 config ƒë·ªÉ auto-start khi reboot:
   
   pm2 save
   pm2 startup

================================================================================
  TROUBLESHOOTING
================================================================================

‚ùå ADMIN KH√îNG C√ì CSS (Trang tr·∫Øng):

   1. Check file t·ªìn t·∫°i:
      ls -la /var/www/sun/backend/public/admin/assets/
      # Ph·∫£i th·∫•y: index-WjAjsFk0.css

   2. Test CSS URL tr·ª±c ti·∫øp:
      curl -I https://sunfoods.vn/adminhoang/assets/index-WjAjsFk0.css
      # Ph·∫£i tr·∫£ v·ªÅ: HTTP/2 200

   3. Check Nginx logs:
      tail -f /var/log/nginx/sunfoods.vn-error.log

   4. Clear browser cache ho√†n to√†n:
      Chrome: Settings ‚Üí Privacy ‚Üí Clear browsing data

‚ùå PM2 PROCESSES KH√îNG CH·∫†Y:

   Check PM2 status:
      pm2 status
      pm2 logs backend --lines 50
      pm2 logs mobile --lines 50

   Restart n·∫øu c·∫ßn:
      pm2 restart all

‚ùå NGINX L·ªñI 502 BAD GATEWAY:

   1. Check backend ƒëang ch·∫°y:
      pm2 status
      curl http://localhost:3000/api/health

   2. Check mobile ƒëang ch·∫°y:
      curl http://localhost:3001

   3. Check Nginx config:
      sudo nginx -t

‚ùå SSL CERTIFICATE L·ªñI:

   1. Verify cert files:
      ls -la /etc/letsencrypt/live/sunfoods.vn/

   2. Renew certificate (n·∫øu h·∫øt h·∫°n):
      sudo certbot renew
      sudo systemctl reload nginx

================================================================================
  USEFUL COMMANDS
================================================================================

# Check service status
  sudo systemctl status nginx
  pm2 status

# View logs
  pm2 logs backend --lines 100
  pm2 logs mobile --lines 100
  tail -f /var/log/nginx/sunfoods.vn-error.log
  tail -f /var/log/nginx/sunfoods.vn-access.log

# Restart services
  pm2 restart all
  sudo systemctl reload nginx

# Monitor resources
  pm2 monit
  htop

# Clear Nginx cache manually
  sudo rm -rf /var/lib/nginx/proxy/*
  sudo systemctl reload nginx

================================================================================
  POST-DEPLOYMENT CHECKLIST
================================================================================

‚ñ° Admin login works at https://sunfoods.vn/adminhoang/login
‚ñ° CSS loads correctly (no white page)
‚ñ° Mobile frontend works at https://sunfoods.vn/
‚ñ° SSL certificate is valid (green padlock)
‚ñ° PM2 processes are running (pm2 status)
‚ñ° Nginx is running (sudo systemctl status nginx)
‚ñ° Backend API responds (curl https://sunfoods.vn/api/health)
‚ñ° No errors in logs (pm2 logs, nginx logs)

================================================================================
  PRODUCTION ENVIRONMENT VARIABLES
================================================================================

ƒê·∫£m b·∫£o file /var/www/sun/backend/.env c√≥ c√°c bi·∫øn sau:

  NODE_ENV=production
  PORT=3000
  DATABASE_URL=postgresql://user:pass@host:5432/dbname
  SESSION_SECRET=your-session-secret
  # ... c√°c bi·∫øn kh√°c

V√† /var/www/sun/customer-mobile/.env:

  NODE_ENV=production
  PORT=3001
  NEXT_PUBLIC_API_URL=https://sunfoods.vn/api
  # ... c√°c bi·∫øn kh√°c

================================================================================
  CONTACT & SUPPORT
================================================================================

N·∫øu g·∫∑p v·∫•n ƒë·ªÅ, g·ª≠i th√¥ng tin sau:

  1. Output c·ªßa: pm2 status
  2. Output c·ªßa: pm2 logs backend --lines 50
  3. Output c·ªßa: tail -100 /var/log/nginx/sunfoods.vn-error.log
  4. Screenshot l·ªói t·ª´ browser DevTools (Network tab)

================================================================================
                          DEPLOYMENT COMPLETE!
================================================================================
